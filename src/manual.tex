\documentclass[a4paper,10pt]{article}
\usepackage[a4paper,includehead,includefoot,mag=1000,
            left=3cm,right=2cm,top=1cm,bottom=2cm]{geometry}
\usepackage{doc,ifpdf,indentfirst,ltxtable,color}
\definecolor{darkblue}{rgb}{0,0,.6}

\ifpdf
  \usepackage[pdftex,hyperindex,unicode]{hyperref}
  \usepackage{cmap}
\else
  \usepackage[hypertex]{hyperref}
\fi

\hypersetup{
  pdftitle           = {User manual for disser package},
  pdfauthor          = {Stanislav Kruchinin},
  pdfsubject         = {disser},
  pdfstartview       = {FitH},
  pdfborder          = {0 0 0},
  bookmarksopen      = true,
  bookmarksnumbered  = true,
  bookmarksopenlevel = 2,
  colorlinks = true,     linkcolor  = darkblue,
  citecolor  = darkblue, filecolor  = darkblue,
  menucolor  = darkblue, urlcolor   = darkblue
}

\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage[english,russian]{babel}

\MakeShortVerb{\|}

\def\file#1{\texttt{#1}}
\def\pkg#1{\textsf{#1}}
\def\cmd#1{\texttt{#1}}

\def\deflabel#1{\ttfamily #1\hfill}
\newenvironment{deflist}[1]{%
  \begin{list}{}{%
  \settowidth\labelwidth{\ttfamily #1}%
  \setlength\leftmargin\labelwidth
  \addtolength\leftmargin\labelsep
  \let\makelabel\deflabel}
}{\end{list}}

\def\fileversion{1.5.0}
\sloppy

\begin{document}
\title{Пакет \pkg{disser}: руководство пользователя}
\date{Версия \fileversion}
\author{Станислав Кручинин\\[6pt]
\normalsize E-mail:
\href{mailto:stanislav.kruchinin@gmail.com}
{\texttt{stanislav.kruchinin@gmail.com}}}

\maketitle

\begin{abstract}\noindent
Данный документ содержит руководство по использованию пакета \pkg{disser}.
Инструкции по установке и обновлению смотрите в файлах \file{README} и \file{README.ru}.
Описание исходных текстов содержится в файлах \href{file:disser.pdf}{\file{disser.pdf}}, \href{file:gost732.pdf}{\file{gost732.pdf}}.
\end{abstract}

\tableofcontents

\section{Введение}

Пакет \pkg{disser} предназначен для верстки диссертаций и авторефератов в соответствии с требованиями ГОСТ~7.0.11--2011 и ВАК.
В состав пакета входят классы \file{disser.cls} и \file{gost732.cls}, а также скрипты для сборки пакета и документов (\file{Makefile}, \file{nomake.cmd}, файлы с расширениями \file{mk} и \file{cmd} в каталоге \file{include}).
Поскольку дипломы и диссертации имеют фиксированную структуру, в пакет также включены их шаблоны (каталог \file{templates}), которые рекомендуется использовать для создания своих документов.

Одной из основных целей создания пакета~\pkg{disser} являлось устранение общего недостатка стандартных классов: отсутствия возможности настройки формата элементов титульного листа, заголовков и записей в автоматически генерируемых списках.
Для достижения этой цели была переопределена значительная часть команд, входящих в ядро \LaTeX{}, и введен ряд новых переменных, которые описаны в комментариях к исходным текстам.
Это позволило значительно упростить разработку пользовательских классов на базе~\pkg{disser}, которые удовлетворяют специфическим требованиями учебных заведений и диссертационных советов.
Примером реализации данного подхода является~\pkg{gost732}, предназначенный для верстки отчетов о НИР в соответствии с ГОСТ~7.32-2001.

\section{Соответствие стандартам}

Пакет позволяет создавать документы, удовлетворяющие следующим стандартам:
\begin{itemize}
\item \href{http://protect.gost.ru/document.aspx?control=8&id=171831}{ГОСТ Р 7.0.11--2011 <<Диссертация и автореферат диссертации. Структура и правила оформления>>};
\item \href{http://protect.gost.ru/document.aspx?control=7&id=130946}{ГОСТ 7.32--2001 <<Отчет о научно-исследовательской работе. Структура и правила оформления>>};
\item \href{http://protect.gost.ru/document.aspx?control=7&id=128845}{ГОСТ Р 7.0.4--2006 <<Издания. Выходные сведения. Общие требования и правила оформления>>};
\item \href{http://protect.gost.ru/document.aspx?control=7&id=173511}{ГОСТ Р 7.0.5--2008 <<Библиографическая ссылка. Общие требования и правила составления>>}.
\end{itemize}

\section{Опции класса}\label{s:opts}

\textbf{Примечание:} полужирным выделены опции и значения, используемые по умолчанию.

\extrarowheight=3pt
\tabcolsep=6pt
\arraycolsep=0pt
\newcolumntype{L}{>{\raggedright}p{4cm}}
\begin{longtable}{L|p{10.5cm}}
\hline\hline
\multicolumn{2}{c}{\textbf{Стандартные опции}}\\
\hline
  8pt, 9pt, 10pt, 11pt, 12pt, \textbf{14pt}, 16pt, 18pt, 20pt &
  Размер шрифта основного текста.
\\\hline
  \textbf{a4paper}, a5paper, b5paper &
  Размеры листов.
\\\hline
  landscape &
  Альбомная ориентация.
\\\hline
  \textbf{oneside}, twoside &
  Односторонняя или двухсторонняя печать.
\\\hline
  draft, \textbf{final} &
  Выводить (draft) или нет (final) пометки, фиксирующие переполнение горизонтального блока для данной строки.
\\\hline
  fleqn &
  Выключные формулы будут выравнены по левому краю, а не по центру.
\\\hline
  leqno &
  Номера будут размещены слева, а не справа от формул.
\\\hline
  \textbf{openany}, openright &
  Главы всегда будут начинаться только с нечетных страниц (т.\,е. справа, если смотреть на разворот) или c любых.
\\\hline
  \textbf{onecolumn}, twocolumn &
  Верстка в один или в два столбца.
\\\hline
  openbib &
  Блоки текста в списке литературы будут печататься на новых строках и с отступом.
\\\hline
  \textbf{titlepage}, notitlepage &
  Печатать титульный лист или нет.
\\\hline
\multicolumn{2}{c}{\textbf{Специфические настройки класса}}
\\\hline
  autoref, bachelor, specialist, master, \textbf{candidate}, doctor &
  Тип документа: автореферат, бакалаврский диплом, диплом специалиста, магистерская, кандидатская или докторская диссертация.
\\\hline
  classified &
  Включает вывод грифа секретности на титульном листе.
\\\hline
  colorlinks &
  Включает цветные гиперссылки. Цвета определяются соответствующими параметрами пакета \pkg{hyperref}.
\\\hline
  facsimile &
  Включает отображение подписей диссертанта и ученого секретаря на титульных листах автореферата и диссертации (только для кандидатских и докторских).
  По умолчанию включена только в шаблоне автореферата.
\\\hline
  fixint &
  Включает замену стандартных знаков интегралов на прямые (из шрифта \pkg{euler}).
\\\hline
  substylefile = filename.rtx &
  Имя файла с описанием стиля документа (оформление титульного листа, нумерация формул, элементов списков и т.\,д.).
  Опция предназначена для подключения собственных стилей документов, отличающихся от стандартных: \file{autoref.rtx},
  \file{bachelor.rtx}, \file{master.rtx}, \file{candidate.rtx}, \file{doctor.rtx}.
  Если данной опции не присвоено значение, то по умолчанию подключается файл, имя которого совпадает с названием типа документа.
\\\hline
\multicolumn{2}{c}{\textbf{Опции для подключения и настройки сторонних пакетов}}
\\\hline
  href &
  Подключение пакета \pkg{hyperref} для создания гиперссылок.
\\\hline
  subf &
  Подключение пакета \pkg{subcaption} для вложенной нумерации рисунков.
\\\hline\hline
\end{longtable}

\section{Шаблоны документов}

Возможности пакета демонстрируются на примере шаблонов дипломов и диссертаций.
В каталоге \file{templates} содержатся документы в кодировке CP-1251, для верстки библиографии используются \BibTeX{}8 со стилем \pkg{gost2008}, пакеты \pkg{natbib} и \pkg{multibib}.
В каталоге \file{templates-utf8} содержатся документы в кодировке UTF-8, для верстки библиографии используются Biber и пакет Bib\LaTeX{} со стилем \pkg{biblatex-gost}.

\section{Система сборки документов}

Для автоматизации сборки и установки в состав пакета входят две системы скриптов: файлы \file{Makefile}, совместимые с GNU Make, и файлы \file{nomake.cmd}, написанные на языке командного интерпретатора \file{cmd.exe} (Windows 2000 и выше).
Скрипты поддерживают одинаковый набор целей (targets).
Использование в Unix-подобных окружениях:
\begin{verbatim}
make <target1> <target2> ...
\end{verbatim}
В Windows:
\begin{verbatim}
nomake <target1> <target2> ...
\end{verbatim}

Далее приведены описания целей в зависимости от каталога, в котором производится сборка.

\def\longestlabel{pdftotiffg44}

\subsection{Каталог \file{disser}}

\begin{deflist}{\longestlabel}
\item[all]
  Сборка классов и шаблонов.
\item[clean]
  Цель \cmd{clean} в каталогах \file{src} и \file{templates}.
\item[doc]
  Сборка DVI- и PDF-версий документации.
\item[help]
  Справка по целям сборки.
\item[install]
  Копирование пакета, документации и шаблонов в дерево каталогов \TeX{}.
  Соответствует цели \cmd{install} в каталогах \file{src} и \file{templates}.
\item[package]
  Сборка пакета.
  Соответствует цели \cmd{package} в каталоге \file{src}.
  Цель по умолчанию.
\item[reinstall]
  Переустановка пакета.
  Соответствует цели \cmd{reinstall} в каталогах \file{src} и \file{templates}.
\item[srcdist]
  Создание архива исходных текстов пакета с помощью команды \cmd{hg archive}.
\item[tds]
  Создание архива скомпилированных файлов пакета и шаблонов.
\item[templates]
  Сборка всех шаблонов.
  Соответствует цели по умолчанию в каталоге \file{templates}.
\item[uninstall]
  Удаление пакета из каталога \TeX{}.
  Соответствует целям \cmd{uninstall} в каталогах \file{src} и \file{templates}.
\end{deflist}

\subsection{Подкаталог \texttt{src}}

\begin{deflist}{\longestlabel}
\item[all]
  Сборка пакета и PDF-версии документации.
  Цель по умолчанию.
\item[clean]
  Удаление файлов, указанных в переменной |CLFILES|.
\item[doc]
  Сборка DVI- и PDF-версий документации.
\item[dvi]
  Сборка DVI-версии документации.
\item[help]
  Справка по целям сборки.
\item[install]
  Копирование пакета в дерево каталогов \TeX{}.
\item[package]
  Сборка пакета.
\item[pdf]
  Сборка PDF-версии документации.
\item[reinstall]
  Переустановка пакета.
\item[uninstall]
  Удаление пакета из каталога \TeX{}.
\end{deflist}

\subsection{Подкаталоги \file{templates} и
 \file{templates/<тип-диссертации>}}

\begin{deflist}{\longestlabel}
\item[clean]
  Удаление файлов, полученных при сборке документа.
  Список файлов определяется переменной |CLFILES|.
\item[dvi]
  Сборка DVI-файла.
\item[figclean]
  Эквивалентно цели \cmd{clean} в каталоге \file{fig}.
\item[help]
  Справка по целям сборки.
\item[html]
  Конвертация DVI в HTML-файл с рисунками.
  Используемая программа: \href{http://www.latex2html.org/}{\cmd{latex2html}}.
\item[pdf]
  Сборка PDF-файла. Цель по умолчанию.
\item[pdf\_2on1]
  Сборка PDF-файла с двумя страницами на один лист A4 и сохранением порядка следования страниц.
\item[pdf\_book]
  Сборка PDF-файла с двумя страницами на один лист A4 для брошюрования.
\item[ps]
  Сборка PostScript-файла.
\item[ps\_2on1]
  Сборка PostScript-файла с двумя страницами на один лист A4 и сохранением порядка следования страниц.
\item[ps\_book]
  Сборка PostScript-файла с двумя страницами на один лист A4 для брошюрования.
\item[rtf]
  Конвертация из DVI в RTF.
\item[srcdist]
  Сборка архива из содержимого текущего каталога.
\end{deflist}

Помимо указанных выше целей, в каталоге \file{templates} доступны следующие:
\begin{deflist}{\longestlabel}
\item[install]
  Копирование шаблонов в дерево каталогов \TeX{}.
\item[reinstall]
  Переустановка шаблонов.
\item[uninstall]
  Удаление шаблонов.
\end{deflist}

\begin{flushleft}
\textbf{Примечания:}

1) Файлы \file{nomake.cmd} в каталогах шаблонов зависят от \file{include/latex.nmk.cmd} и \file{include/latex.fig.nmk.cmd}.
Файлы \file{Makefile} зависят от \file{include/latex.mk} и \file{include/latex.fig.mk}.

2) \file{Makefile} и \file{nomake.cmd} могут использовать цели из каталога \file{fig}.
\end{flushleft}

\subsection{Подкаталоги \file{templates/<тип-диссертации>/fig}}

\begin{deflist}{\longestlabel}
\item[bmtoeps]
  Конвертация растровых изображений в EPS.
  Используемая программа: \href{http://code.google.com/p/sam2p/}{\cmd{sam2p}}.
  Список файлов определяется переменной |BMTOEPSFILES|.
  По умолчанию обрабатываются все файлы с расширениями \file{jpg}, \file{png}, \file{tif}.
\item[clean]
  Удаление файлов.
  Список файлов определяется переменной |FIGCLFILES|.
  По умолчанию обрабатываются все файлы с расширениями \file{pdf}, \file{jpg}, \file{png} и \file{tif}.
\item[epstoeps]
  Псевдоним для \cmd{optimize}.
\item[epstopdf]
  Конвертация EPS в PDF.
  Используемая программа: \cmd{epstopdf} (входит в состав MiK\TeX{} и \TeX\ Live).
  Список файлов определяется переменной |E2PFILES|.
  По умолчанию обрабатываются все файлы с расширением \file{eps}.
\item[fixbb]
  Исправление границ видимой области (bounding box) в EPS-файлах.
  Используемая программа: \href{http://pages.cs.wisc.edu/~ghost/gsview/epstool.htm}{\cmd{epstool}}.
  Список файлов определяется переменной |FBBFILES|.
  По умолчанию обрабатываются все файлы с расширением \file{eps}.
\item[help]
  Справка по целям сборки. Цель по умолчанию.
\item[optimize]
  Оптимизация EPS-файлов и исправление границ видимой области.
  В результате оптимизации все шрифты переводятся в кривые.
  Используемые программы: \cmd{eps2eps} из пакета Ghostscript и \cmd{epstool}.
  Список файлов определяется переменной |OPTFILES|.
  По умолчанию обрабатываются все файлы с расширением \file{eps}.
\item[pdftopng256]
  Конвертация PDF в 256-цветный PNG.
  Используемая программа: пакет Ghostscript.
  Список файлов определяется переменной |PDF2PNGFILES|.
  По умолчанию обрабатываются все файлы с расширением \file{pdf}.
\item[pdftotiffg4]
  Конвертация PDF в черно-белый TIFF (алгоритм сжатия CCITT Group 4).
  Используемая программа: пакет Ghostscript.
  Список файлов определяется переменной |PDF2TIFFILES|.
  По умолчанию обрабатываются все файлы с расширением \file{pdf}.
\end{deflist}

\section{Стили колонтитулов}

Поскольку в российских диссертациях обычно не используются колонтитулы, содержащие название текущей главы документа, то стили, реализованные в данном классе, влияют лишь на положение номера страницы.
Стиль колонтитулов обычных страниц документа задается в преамбуле командой |\pagestyle{<style>}|, а стиль страниц, с которых начинается новая глава "--- командой |\chapterpagestyle{<style>}|.
Здесь |<style>| может принимать следующие значения:
\begin{deflist}{\longestlabel}
\item[empty]      Страница без номера.
\item[footleft]   Номер внизу и слева.
\item[footcenter] Номер внизу и по середине.
\item[footright]  Номер внизу и справа.
\item[headleft]   Номер вверху и слева.
\item[headcenter] Номер вверху и по середине.
\item[headright]  Номер вверху и справа.
\item[plain]      Совпадает с |footcenter|.
\end{deflist}

Для односторонних документов шрифт надписей в верхнем и нижнем колонтитулах можно задать путем переопределения команд |\headfont| и |\footfont|.
В двухсторонних документах следует использовать команды |\evenheadfont|, |\evenfootfont|, |\oddheadfont|, |\oddfootfont| для четных и нечетных страниц, соответственно.

\textbf{Пример:} номера всех страниц одностороннего документа печатаются в верхнем колонтитуле по центру, шрифтом размера |\small|.
\begin{verbatim}
\def\headfont{\small}
\pagestyle{headcenter}
\chapterpagestyle{headcenter}
\end{verbatim}

\section{Оформление библиографии}

Для оформления библиографических ссылок в соответствии с ГОСТ Р 7.0.5-2008 используются стили \file{gost2008.bst} и \file{gost2008s.bst}.

При описании русскоязычных источников следует явным образом присваивать полю |language| значение |russian|.
Пример:
\begin{verbatim}
@BOOK{Anselm_1978,
  author       = {А. И. Ансельм},
  title        = {Введение в теорию полупроводников},
  publisher    = {Наука},
  address      = {Москва},
  year         = {1978},
  language     = {russian},
}
\end{verbatim}
Для указания даты обращения к Интернет-ресурсам следует использовать поле |urldate|. Пример:
\begin{verbatim}
@INCOLLECTION{InP,
  title        = {InP Basic Parameters at 300 K},
  booktitle    = {Electronic archive New Semiconductor Materials.
                  Characteristics and Properties},
  organization = {Ioffe Physico-Technical Institute},
  address      = {St. Petersburg},
  year         = {2001},
  url          = {http://www.ioffe.rssi.ru/SVA/NSM/Semicond/InP/basic.html},
  urldate      = {01.11.2009},
}
\end{verbatim}

Для работы с русскоязычными библиографическими ссылками необходимо использовать интерпретатор \cmd{bibtex8}, поддерживающий 8-битные символы.
В зависимости от кодировки текста в bib-файле, необходимо подключать соответствующий csf-файл с описанием кодовой страницы и порядка сортировки, например, \file{cp1251.csf} из пакета \pkg{gost}.

Последовательность команд, используемая для полной сборки документа с библиографией в кодировке CP-1251, имеет следующий вид:
\begin{verbatim}
pdflatex <tex-file>
bibtex8 -H -c <csf-file> <aux-file>
pdflatex <tex-file>
pdflatex <tex-file>
\end{verbatim}
Здесь |<tex-file>| "--- файл документа, |<aux-file>| "--- имя aux-файла, который генерируется после первой этапа компиляции (совпадает с именем tex-файла), |<csf-file>| "--- файл описания кодовой страницы и порядка сортировки.

Сборка документов в кодировке UTF-8:
\begin{verbatim}
pdflatex <tex-file>
biber <bcf-file>
pdflatex <tex-file>
pdflatex <tex-file>
\end{verbatim}

\section{Авторефераты кандидатских и докторских диссертаций}

\subsection{Общий текст}

В соответствии с требованиями, раздел <<Общая характеристика работы>> автореферата и глава <<Введение>> диссертации должны совпадать.
Общие разделы создаются с помощью команды |\mkcommonsect| в файле \file{common.tex}, который подключается из \file{autoref.tex} и \file{thesis.tex}.

Пример:
\begin{verbatim}
\mkcommonsect{novelty}{Научная новизна}{%
Текст раздела
}
\end{verbatim}
Здесь первый аргумент "--- корень имени создаваемых макросов (|\noveltysection| и |\noveltytext|), второй аргумент "--- заголовок раздела (значение |\noveltysection|), третий "--- текст раздела (значение |\noveltytext|).

\subsection{Список работ диссертанта}

В автореферате список работ диссертанта должен быть отделен от списка цитируемой литературы.
Для этого в документах с однобайтовой кодировкой используется пакет \pkg{multibib}, а для документов в кодировке UTF-8 "--- пакет Bib\LaTeX{}.
Описание библиографических ссылок на работы диссертанта должно находиться в файле \file{thesis.bib} вместе с остальными ссылками.

Сборка автореферата в кодировке UTF-8 осуществляется стандартным способом.
Поскольку пакет \pkg{multibib} создает отдельные |aux|-файлы для каждой библиографии, полная сборка автореферата в кодировке CP-1251 выполняется следующей последовательностью команд:
\begin{verbatim}
pdflatex autoref
bibtex8 -H -c cp1251 autoref
bibtex8 -H -c cp1251 my
pdflatex autoref
pdflatex autoref
\end{verbatim}
В кодировке UTF-8 сборка документа с двумя библиографиями не отличается от стандартной.

Операция полной сборки документов осуществляется командой:
\begin{verbatim}
nomake all
\end{verbatim}
в Windows или
\begin{verbatim}
make all
\end{verbatim}
в Unix-подобных окружениях.
Сборка только автореферата в Windows:
\begin{verbatim}
set target=autoref
nomake
\end{verbatim}
Для возврата к сборке диссертации следует однократно присвоить переменной |TARGET| значение |thesis|:
\begin{verbatim}
set target=thesis
nomake
\end{verbatim}

Команда для сборки автореферата в Unix-подобных окружениях:
\begin{verbatim}
env TARGET=autoref make
\end{verbatim}


\subsection{Подписи диссертанта и ученого секретаря}

Согласно требованиям, автореферат должен быть подписан диссертантом и ученым секретарем.
Для автоматической вставки графических файлов с подписями в классе предусмотрена опция \cmd{facsimile}.
Эта опция по умолчанию включена только в шаблонах авторефератов.
Факсимиле диссертанта находится в файле \file{./fig/facsimile.<type>}, факсимиле ученого секретаря диссертационного совета "--- в файле \file{./fig/sec-facsimile.<type>}.
Здесь \file{<type>} "--- один из типов графических файлов, поддерживаемых в \LaTeX{} (\file{eps}) или в pdf\LaTeX{} (\file{pdf}, \file{tif}, \file{png}).
Команда |\facsimile|, включающая файл с подписью диссертанта в документ, определена в файле \file{titledefs.dtx}.
Команда, включающая файл с подписью ученого секретаря, находится в файле \file{autoref.tex}.

\section{Настройка пакета под нестандартные требования диссертационных советов}

Код, определяющий вид титульного листа, нумерацию объектов и другие параметры, находится в файлах, имена которых совпадают с соответствующими опциями класса (см. раздел~\ref{s:opts}):
\file{autoref.dtx}, \file{bachelor.dtx}, \file{specialist.dtx}, \file{master.dtx}, \file{candidate.dtx}, \file{doctor.dtx}.
После сборки класса из исходных текстов из них получаются файлы с расширением |rtx|.

Для внесения изменений в файлы пакета с расширениями |bst|, |cls| и |rtx| следует создавать их копии в каталоге с Вашим документом.
При сборке документа \LaTeX{} ищет подключаемые файлы в каталоге компилируемого |tex|-файла, поэтому будет использована локальная копия файлов с вашими изменениями.

\end{document}
